## Hi👋

こちらは下記を参考に作ったレポジトリです。
[Udemy Go 言語で学ぶ実施 gRPC 入門](https://www.udemy.com/course/go-grpc-x/)

Go + gRPC がメイン

### 詳細

- section1 ~ 4 basics フォルダ
- section5 ~ github.com/Taguchi-ivi/go_grpc_pra フォルダ

## そもそも Protocol Buffers とは

google によって 2008 年に os になったスキーマ言語

特徴

- gPRC のデータフォーマットとして使用されている
- プログラミング言語から独立している
- バイナリ形式にシリアライズするのでサイズが小さく高速な通信
- 型安全にデータのやりとりが可能
- json に変換も可能

メリデメ

- 一部言語では未対応
- 複雑すぎる構造には不向き
- バイナリに変換された後は人間には読めない
- 型安全
- データサイズは小さい

開発の進め方
① スキーマの定義(.proto) これが仕様書代わりにもなる
② 開発言語のオブジェクトを自動生成 スキーマが決まっていると並行で bff の実装を進めることができる
③ バイナ形式へシリアライズ

## コンパイラ

```bash
# -IPATH パス指定, :で区切ることも可能(defaultは-I.)
# not gPRC
protoc -I. --go_out=. proto/*.proto
```

```bash
# gPRC
protoc -I. --go_out=. --go-grpc_out=. proto/*.proto
```

## gPRC とは

Coogle によって 2015 年に os 化された PRC(Remote Procedure Call)のためのプロトコル

RPC(Remote 遠隔地 Procedure 手続き Call 呼び出す)とは

- ネットワーク上の他の端末と通信するための仕組み
- REST API のようにパスやメソッドを指定する必要はなく、メソッド名と引数を指定する
- gRPC 以外にも JSON-RPC などもある

gRPC の特徴

- データフォーマットに protocol buffers 使用
- IDL(protocol buffers)からサーバー側、クライアント側に必要なソースコードを生成
- 通信には HTTP/2 使用

適したケース

- Microservice 間の通信
  - 複数の言語やプラットフォームで構成される可能性がある
  - バックエンド間であれば gRPC の恩恵が多く得られる
- モバイルユーザーが利用するサービス
  - 通信量が削減できる、通信容量制限にかかりにくい
- 速度が求められる場合

開発の流れ

- proto ファイル作成
- proto ファイルをコンパイルしてサーバー、クライアントの雛形コード作成
- 雛形コードを使用して実装

## HTTP/2 とは

demo: http://www.http2demo.io/

特徴

- ストリームという概念を導入
  - 1 つの TCP 接続を用いて複数のリクエスト/レスポンスのやり取りが可能
  - TPC 接続を減らすことができるので、サーバーの負荷軽減
- ヘッダーの圧縮
  - 圧縮さらにキャッシュを行うことで、差分のみを送受信することで効率化
- サーバープッシュ
  - クライアントからのリクエストなしにサーバーからデータを送信できる
  - 事前に必要と思われるリソースを送信しておくことで、ラウンドトリップの回数を削減し、リソース読み込みまでの時間短縮

通信方式

- Unary RPC
  - 1 リクエスト 1 レスポンス
  - 用途は API など
- Server Streaming RPC
  - 1 リクエスト 多 レスポンス
  - クライアントはサーバから送信完了の信号が送信されるまでストリームのメッセージを読み続ける
  - 用途はサーバーからのプッシュ通知など
- Client Streaming RPC
  - 多 リクエスト 1 レスポンス
  - サーバーはクライアントからリクエスト完了の信号が送信されるまでストリームからメッセージを読み続けてレスポンスを返さない
  - 用途は大きなファイルのアップロードなど
- Bidirectional Streaming RPC
  - 多 リクエスト 多 レスポンス
  - クライアントとサーバーのストリームが独立しており、リクエストとレスポンスはどのような順序でも良い
  - 用途はチャットやオンライン対戦ゲームなど

## interceptor とは

- メソッドの前後に処理を行うための仕組み
- 認証やロギング、監視やバリデーションなど複数の RPC で共通して行いたい処理で使用
- Unary 用とストリーミング用が用意されている

## エラーハンドリング

- REST API だと数字(400,500)を覚える必要があったが、grpc のエラーハンドリングは文字列なので覚える必要もない
- 下記参照
  https://grpc.github.io/grpc/core/md_doc_statuscodes.html
